var L=Object.defineProperty;var s=(n,r)=>L(n,"name",{value:r,configurable:!0});function g(n,...r){if(!r.length)return n;let e=r.shift();if(n||(n={}),d(n)&&d(e))for(let t in e)d(e[t])?(n[t]||Object.assign(n,{[t]:{}}),g(n[t],e[t])):Object.assign(n,{[t]:e[t]});return g(n,...r)}s(g,"_deepMerge");function m(n,...r){return g(structuredClone(n),...r.map(e=>structuredClone(e)))}s(m,"deepMerge");function d(n){return n&&typeof n=="object"&&!Array.isArray(n)}s(d,"isObject");var f=["listeners","value","notify","get","set","subscribe","parent","isStore"];function b(n,r){let e={};for(let t in n)n.hasOwnProperty(t)&&(typeof n[t]=="object"&&!Array.isArray(n[t])&&n[t]!==null?e[t]=b(n[t],e):e[t]=new y(n[t],e));return e.isStore=!0,e.listeners=[],e.value=void 0,e.parent=r,e.notify=(t=0)=>(e.listeners.forEach(o=>o(e)),t>0&&r&&typeof r.notify=="function"&&r.notify(t-1),e),e.get=()=>{let t={};for(let o in e)f.includes(o)||e.hasOwnProperty(o)&&(t[o]=e[o].get());return t},e.getPointer=()=>{let t={};for(let o in e)f.includes(o)||e.hasOwnProperty(o)&&(t[o]=e[o]);return t},e.set=(t,o=0)=>{for(let i in t){if(f.includes(i))throw new Error(`Reserved key: ${i}`);if(!e.hasOwnProperty(i))throw new Error(`Unknown key: ${i}`);if(e[i].isStore)throw new Error(`Cannot set nested store: ${i}`);let c=t[i];if(typeof c=="object"&&c!==null&&!Array.isArray(c))throw new Error(`Invalid value for key: ${i}`)}for(let i in t)e[i].set(t[i],o);return e},e.subscribe=t=>(e.listeners.push(t),e),e}s(b,"createStore");var y=class{static{s(this,"ReactiveCell")}value;parent;listeners=[];isStore=!1;constructor(r,e){this.value=r,this.parent=e}get(){return this.value}set(r,e=0){return this.value=r,this.notify(e),this}notify(r=0){return this.listeners.forEach(e=>e(this.value)),r>0&&this.parent&&typeof this.parent.notify=="function"&&this.parent.notify(r-1),this}subscribe(r){return this.listeners.push(r),this}};function h(n,r,e=!1){e&&r.set(n.value),n.addEventListener("input",()=>{r.set(n.value)}),r.subscribe(t=>{n.value!==t&&(n.value=t)})}s(h,"watchInput");function x(n,r,e=!1){e&&r.set(n.value),n.addEventListener("change",()=>{r.set(n.value)}),r.subscribe(t=>{n.value!==t&&(n.value=t)})}s(x,"watchSelect");function k(n,r,e=!1){e&&r.set(n.checked),n.addEventListener("change",()=>{r.set(n.checked)}),r.subscribe(t=>{n.checked!==t&&(n.checked=t)})}s(k,"watchCheckbox");var K=window?.VQLClient?.fetchVQL;globalThis.lo=console.log;function v(n){let r={};for(let{_id:e,v:t}of n){let o=e.split("."),i=r;for(let c=0;c<o.length-1;c++){let l=o[c];(!(l in i)||typeof i[l]!="object"||Array.isArray(i[l]))&&(i[l]={}),i=i[l]}let a=o[o.length-1];i[a]=t}return r}s(v,"keysToObj");var S=class{constructor(r,e,t,o={}){this.db=r;this.storeData=e;this.root=t;this.opts={collection:"settings",...o}}static{s(this,"Engine")}opts;store;async init(){await this._initStoreAndDb(),await this._initWatch()}async _initStoreAndDb(){let r=await this.db.find(this.opts.collection),e=v(r),t=m({},this.storeData,e);this.store=b(t)}_pickCell(r){let e=this.store;for(let t of r)e=e[t];return e}async _initWatch(){this.root.querySelectorAll("[data-id]").forEach(r=>{let e=r.getAttribute("data-id");if(!e)return;let t=this._pickCell(e.split("."));t.subscribe(i=>{this.db.updateOneOrAdd(this.opts.collection,{_id:e},{v:i})});let o=r;o.type==="checkbox"?(o.checked=t.get(),k(o,t)):o instanceof HTMLSelectElement?(o.value=t.get(),x(o,t)):(o.value=t.get(),h(o,t))})}};function p(n,r=!1){let e=document.createElement("label");return e.innerHTML=n,r&&e.classList.add("inline"),e}s(p,"generateBase");function T({id:n,title:r,value:e,number:t,inline:o}){let i=p(r,o),a=document.createElement("input");return t?(a.setAttribute("type","number"),typeof t.min<"u"&&a.setAttribute("min",t.min.toString()),typeof t.max<"u"&&a.setAttribute("max",t.max.toString()),typeof t.step<"u"&&a.setAttribute("step",t.step.toString())):a.setAttribute("type","text"),a.setAttribute("data-id",n),e=typeof e=="number"?e.toString():e,a.value=e||"",i.appendChild(a),i}s(T,"generateInput");function w({id:n,title:r,options:e,value:t,inline:o}){let i=p(r,o),a=document.createElement("select");a.setAttribute("data-id",n);for(let c of e){let l=document.createElement("option");l.setAttribute("value",c.value),l.innerHTML=c.label||c.value,a.appendChild(l)}return a.value=t||"",i.appendChild(a),i}s(w,"generateSelect");function A({id:n,title:r,value:e,inline:t}){let o=p(r,t),i=document.createElement("input");return i.setAttribute("type","checkbox"),i.setAttribute("data-id",n),i.checked=e||!1,o.insertBefore(i,o.firstChild),o}s(A,"generateCheckbox");function E({id:n,title:r,value:e,width:t,height:o,cols:i,rows:a,inline:c}){let l=p(r,c),u=document.createElement("textarea");return u.setAttribute("data-id",n),u.value=e||"",(t||i)&&(u.style.maxWidth="100%"),(o||a)&&(u.style.maxHeight="100%"),t&&(u.style.width=typeof t=="number"?`${t}px`:t),o&&(u.style.height=typeof o=="number"?`${o}px`:o),i&&(u.cols=i),a&&(u.rows=a),l.appendChild(u),l}s(E,"generateArea");function D(n){switch(n.type){case"input":return T(n);case"select":return w(n);case"checkbox":return A(n);case"area":return E(n);default:let r=n;throw new Error(`Unknown element type: ${r}`)}}s(D,"generateElement");function ye(n,r){n.forEach(e=>r.appendChild(D(e)))}s(ye,"generateHTML");export{S as Engine,D as generateElement,ye as generateHTML};
//# sourceMappingURL=index.js.map
